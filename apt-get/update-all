#!/bin/bash

sudo echo true >/dev/null || (echo "Root is needed to perform an update!" && exit 2)

echo 'Updating the repository cache...'
sudo apt-get -ymuq update >/dev/null #update the repository cache
echo 'Checking for upgraded packages...'
RET=$(sudo apt-get -qs --assume-no upgrade) #Store the output of a simulated upgrade
MSG=$(echo -e "Reading package lists...\nBuilding dependency tree...\nReading state information...\n0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.")
if [ "$RET" = "$MSG" ]; then #$MSG has to be a variable because $RET contains newlines, which we can't get without echoing
  MORE=''
else
  while [ ! "$RET" = "$MSG" ]; do
    echo 'Upgrading user packages...'
    echo 'Please be patient; this can take a while.'
    #upgrade all the 'mundane' programs
    sudo apt-get -ymuq upgrade >/dev/null || (echo "Something went wrong during this stage! If you see this message multiple times, hold down Ctrl-C until this script stops." && sleep 5)
    echo 'Upgrading distro and system files...'
    echo 'Please be patient; this can take a while.'
    #upgrade the distro and system files
    sudo apt-get -ymuq dist-upgrade >/dev/null || (echo "Something went wrong during this stage! If you see this message multiple times, hold down Ctrl-C until this script stops." && sleep 5)
    echo 'Removing unneeded packages...'
    #uninstall all unnecessary/orphaned packages
    sudo apt-get -ymuq autoremove >/dev/null || (echo "Something went wrong during this stage! If you see this message multiple times, hold down Ctrl-C until this script stops." && sleep 5)
    echo 'Cleaning up...'
    #delete all unnecessary packages left over
    sudo apt-get -ymuq autoclean >/dev/null || (echo "Something went wrong during this stage! If you see this message multiple times, hold down Ctrl-C until this script stops." && sleep 5)
    echo 'Updating the repository cache...'
    #update the repository cache
    sudo apt-get -ymuq update >/dev/null || (echo "Something went wrong during this stage! If you see this message multiple times, hold down Ctrl-C until this script stops." && sleep 5)
    echo 'Checking for more upgraded packages...'
    #update the simulated upgrade
    RET=$(sudo apt-get -qs --assume-no upgrade) 
  done
  MORE=' more'
fi
echo "No$MORE upgrades are available at this time."
